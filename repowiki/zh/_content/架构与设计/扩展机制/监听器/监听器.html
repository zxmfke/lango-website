<!DOCTYPE html>

<html>
<head>
<style>
      /*! ADAPTED
    Typeplate : Starter Kit
    URL ........... http://typeplate.com
    Version ....... 3.0.2
    Github ........ https://github.com/typeplate/starter-kit
    Authors ....... Dennis Gaebel (@gryghostvisuals) & Zachary Kain (@zakkain)
    License ....... Creative Commmons Attribution 3.0
    License URL ... https://github.com/typeplate/starter-kit/blob/master/license.txt
    */

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        text-rendering: optimizeLegibility;
        line-height: 1;
        margin-top: 0;
        color: #222;
      }

      blockquote + figcaption cite {
        display: block;
        font-size: inherit;
        text-align: right;
      }

      body {
        word-wrap: break-word;
      }

      pre code {
        word-wrap: normal;
      }

      body {
        -webkit-hyphens: auto;
        -ms-hyphens: auto;
        hyphens: auto;
        color: #444;
      }

      h1 {
        font-size: 2em;
        /* 2*16 = 32 */
      }

      h2 {
        font-size: 1.5em;
        /* 1.5*16 = 24 */
      }

      h3 {
        font-size: 1.17em;
        /* 1.17*16 = 18.72 */
      }

      h4 {
        font-size: 1em;
        /* 1*16 = 16 */
      }

      h5 {
        font-size: 0.83em;
        /* 0.83*16 = 13.28 */
      }

      h6 {
        font-size: 0.75em;
        /* 0.75*16 = 12 */
      }

      h1 {
        margin: 2.42424rem 0 1.454544rem;
      }

      h2 {
        margin: 2.0202rem 0 1.21212rem;
      }

      h3 {
        margin: 1.61616rem 0 1rem;
      }

      h4 {
        margin: 1.21212rem 0 1;
      }

      h5 {
        margin: 0.80808rem 0;
      }

      h6 {
        margin: 0.70707rem 0;
      }

      p {
        margin: auto auto 1.5rem;
      }

      small {
        font-size: 65%;
      }

      input,
      abbr,
      acronym,
      blockquote,
      code,
      kbd,
      q,
      samp,
      var {
        -webkit-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
      }

      pre {
        white-space: pre;
      }

      pre code {
        white-space: -moz-pre-wrap;
        white-space: pre-wrap;
      }

      code {
        white-space: pre;
        font-family: SF Mono, Consolas, Dejavu Sans Mono, Menlo, monospace;
      }

      abbr {
        -webkit-font-variant: small-caps;
        -moz-font-variant: small-caps;
        -ms-font-variant: small-caps;
        font-variant: small-caps;
        font-weight: 600;
        text-transform: lowercase;
        color: gray;
      }

      abbr[title]:hover {
        cursor: help;
      }

      /* FROM http://purecss.io/layouts/side-menu/  adapted to remove pure classes*/

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol";
        color: #444;
      }

      img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: auto;
      }

      code,
      pre {
        background-color: #f5f5f5;
        color: #444;
        border-radius: 2px;
        text-shadow: 0px 1px 0px white;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
      }

      pre code {
        border: none;
        box-shadow: none;
      }

      pre {
        padding: 0.5em;
      }

      code {
        display: inline-block;
        padding: 0 0.5em;
        line-height: 1.4;
        font-size: 0.9em;
      }

      table {
        border-spacing: 0;
        margin-bottom: 1.5rem;
      }

      table th,
      table td {
        padding: 0.3em 0.7em;
      }

      table th {
        background-color: #f4f4f4;
        border-bottom: 2px solid #444;
      }

      table td {
        border: 1px solid #f5f5f5;
      }

      /* Add transition to containers so they can push in and out. */

      #layout,
      #menu,
      .menu-link {
        -webkit-transition: all 0.2s ease-out;
        -moz-transition: all 0.2s ease-out;
        -ms-transition: all 0.2s ease-out;
        -o-transition: all 0.2s ease-out;
        transition: all 0.2s ease-out;
      }

      /* This is the parent `<div>` that contains the menu and the content area. */

      #layout {
        position: relative;
        padding-left: 0;
      }

      #layout.active #menu {
        left: 250px;
        width: 250px;
      }

      #layout.active .menu-link {
        left: 250px;
      }

      /* The content `<div>` is where all your content goes. */

      .content {
        margin: 50px auto;
        padding: 0 2em;
        max-width: 80ex;
        line-height: 1.6em;
      }

      /*
      The `#menu` `<div>` is the parent `<div>` that contains the menu that
      appears on the left side of the page.
      */

      #menu {
        margin-left: -250px;
        /* "#menu" width */
        width: 250px;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 1000;
        /* so the menu or its navicon stays above all content */
        background: #f4f4f4;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        font-size: 0.9em;
      }

      @media print {
        #menu,
        .menu-link {
          display: none !important;
        }
      }

      a,
      a * {
        text-decoration: none;
        color: #2483cc;
      }

      a:visited {
        text-decoration: none;
        color: #2483cc;
      }

      /* All anchors inside the menu should be styled like this. */

      #menu a {
        display: block;
        padding: 0.5em 0.5em;
      }

      #menu a:first-letter {
        text-transform: capitalize;
      }

      #menu ul {
        list-style-type: none;
        padding: 0;
        margin: 1em 0.5em;
      }

      #menu ul ul {
        margin-top: 0.5em;
        margin-left: 0.5em;
        border-left: 4px solid rgba(255, 255, 255, 0.5);
      }

      /* Change color of the anchor links on hover/focus. */

      #menu li a:hover,
      #menu li a:focus {
        background: rgba(255, 255, 255, 0.4);
      }

      /* This styles the selected menu item `<li>`. */

      #menu li a.active {
        background: rgba(0, 0, 0, 0.05);
      }

      /* This styles a link within a selected menu item `<li>`. */

      #menu li a.active {
        color: #222;
      }

      /* This styles the menu heading. */

      #menu li.heading {
        font-size: 0.9em;
        text-transform: uppercase;
        color: #000;
      }

      #menu li.heading > * {
        padding: 0.5em;
        display: block;
      }

      #menu li.heading a {
        color: #0c68af;
      }

      /* -- Dynamic Button For Responsive Menu -------------------------------------*/

      /*
      `.menu-link` represents the responsive menu toggle that shows/hides on
      small screens.
      */

      .menu-link {
        position: fixed;
        display: block;
        /* show this only on small screens */
        top: 0;
        left: 0;
        /* "#menu width" */
        font-size: 10px;
        /* change this value to increase/decrease button size */
        z-index: 10;
        width: 2em;
        height: auto;
        padding: 1.6em 1.2em;
        border-radius: 0 2px 2px 0;
      }

      .menu-link:hover {
        background: #f4f4f4;
      }

      .menu-link span {
        position: relative;
        display: block;
      }

      .menu-link span,
      .menu-link span:before,
      .menu-link span:after {
        background-color: #555;
        width: 100%;
        height: 0.2em;
        border-radius: 1em;
      }

      .menu-link span:before,
      .menu-link span:after {
        position: absolute;
        margin-top: -0.6em;
        content: " ";
      }

      .menu-link span:after {
        margin-top: 0.6em;
      }

      /* Hides the menu at `48em`, but modify this based on your app's needs. */

      @media (min-width: 48em) {
        .header,
        .content {
          padding-left: 2em;
          padding-right: 2em;
        }

        #layout {
          padding-left: 250px;
          /* left col width "#menu" */
          left: 0;
        }
        #menu {
          left: 250px;
        }

        .menu-link {
          position: fixed;
          left: 250px;
          display: none;
        }

        #layout.active .menu-link {
          left: 250px;
        }
      }

      @media (max-width: 48em) {
        /* Only apply this when the window is small. Otherwise, the following case results in extra padding on the left:
         * Make the window small.
         * Tap the menu to trigger the active state.
         * Make the window large again.
         */
        #layout.active {
          position: relative;
          left: 250px;
        }
      }

      /* Heading anchors and permalinks */
      h1[id],
      h2[id],
      h3[id],
      h4[id],
      h5[id],
      h6[id] {
        position: relative;
      }
      .heading-anchor-permalink {
        /* Position the permalink to the left of the title */
        position: absolute;
        right: 100%;
        /* Add some spacing as padding to not lose the hover */
        padding-right: 0.6rem;
        /* Make it only visible on heading hover, see below */
        opacity: 0;
      }
      h1[id]:hover .heading-anchor-permalink,
      h2[id]:hover .heading-anchor-permalink,
      h3[id]:hover .heading-anchor-permalink,
      h4[id]:hover .heading-anchor-permalink,
      h5[id]:hover .heading-anchor-permalink,
      h6[id]:hover .heading-anchor-permalink {
        opacity: 0.5;
      }
    </style>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<style>
        .mermaid-diagram {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
<style>
        /* Collapsible Menu Styles */
        #menu .heading {
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }

        #menu .heading::after {
            content: "+";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
        }

        #menu .heading.expanded::after {
            content: "-";
        }

        #menu ul ul {
            display: none; /* Default hidden */
        }

        #menu ul ul.expanded {
            display: block;
        }
        
        /* Ensure the active item's parent is expanded */
        #menu ul ul:has(.active) {
            display: block;
        }
        
        /* Ensure the active item's parent heading has the minus sign */
        /* This is tricky with CSS only, we will handle it with JS */
    </style>
</head>
<body>
<div id="layout">
<!-- Menu toggle -->
<a class="menu-link" href="#menu" id="menuLink">
<!-- Hamburger icon -->
<span></span>
</a>
<nav id="menu">
<ul><li><a class="" href="../../../项目概述.html">项目概述</a></li><li><a class="" href="../../../快速入门.html">快速入门</a></li><li><a class="" href="../../../贡献指南.html">贡献指南</a></li><li class="heading"><span>架构与设计</span></li><ul><li><a class="" href="../../架构与设计.html">架构与设计</a></li><li><a class="" href="../../架构权衡与决策.html">架构权衡与决策</a></li><li class="heading"><span>扩展机制</span></li><ul><li><a class="" href="../命令API.html">命令API</a></li><li><a class="" href="../扩展机制.html">扩展机制</a></li><li class="heading"><span>监听器</span></li><ul><li><a class="" href="可监听图.html">可监听图</a></li><li><a class="" href="可监听节点.html">可监听节点</a></li><li><a class="active" href="监听器.html">监听器</a></li><li><a class="" href="监听器使用模式.html">监听器使用模式</a></li><li><a class="" href="节点事件类型.html">节点事件类型</a></li><li><a class="" href="节点监听器接口.html">节点监听器接口</a></li></ul><li class="heading"><span>追踪</span></li><ul><li><a class="" href="../追踪/被追踪的可运行对象.html">被追踪的可运行对象</a></li><li><a class="" href="../追踪/追踪.html">追踪</a></li><li><a class="" href="../追踪/追踪事件类型.html">追踪事件类型</a></li><li><a class="" href="../追踪/追踪器组件.html">追踪器组件</a></li><li><a class="" href="../追踪/追踪跨度模型.html">追踪跨度模型</a></li></ul></ul><li class="heading"><span>核心引擎设计</span></li><ul><li><a class="" href="../../核心引擎设计/核心引擎设计.html">核心引擎设计</a></li><li class="heading"><span>并发执行</span></li><ul><li><a class="" href="../../核心引擎设计/并发执行/协程管理.html">协程管理</a></li><li><a class="" href="../../核心引擎设计/并发执行/同步机制.html">同步机制</a></li><li><a class="" href="../../核心引擎设计/并发执行/并发执行.html">并发执行</a></li><li class="heading"><span>状态合并策略</span></li><ul><li><a class="" href="../../核心引擎设计/并发执行/状态合并策略/基于 StateSchema 的状态合并.html">基于 StateSchema 的状态合并</a></li><li><a class="" href="../../核心引擎设计/并发执行/状态合并策略/状态合并策略.html">状态合并策略</a></li><li><a class="" href="../../核心引擎设计/并发执行/状态合并策略/自定义 StateMerger 函数.html">自定义 StateMerger 函数</a></li><li><a class="" href="../../核心引擎设计/并发执行/状态合并策略/默认最后写入获胜策略.html">默认最后写入获胜策略</a></li></ul></ul><li class="heading"><span>执行中断</span></li><ul><li><a class="" href="../../核心引擎设计/执行中断/中断配置.html">中断配置</a></li><li><a class="" href="../../核心引擎设计/执行中断/动态中断.html">动态中断</a></li><li><a class="" href="../../核心引擎设计/执行中断/执行中断.html">执行中断</a></li><li><a class="" href="../../核心引擎设计/执行中断/状态恢复.html">状态恢复</a></li></ul><li class="heading"><span>执行循环</span></li><ul><li><a class="" href="../../核心引擎设计/执行循环/执行循环.html">执行循环</a></li><li><a class="" href="../../核心引擎设计/执行循环/状态更新流程.html">状态更新流程</a></li><li><a class="" href="../../核心引擎设计/执行循环/节点调度.html">节点调度</a></li><li><a class="" href="../../核心引擎设计/执行循环/边触发机制.html">边触发机制</a></li></ul><li class="heading"><span>状态更新机制</span></li><ul><li><a class="" href="../../核心引擎设计/状态更新机制/临时状态管理.html">临时状态管理</a></li><li><a class="" href="../../核心引擎设计/状态更新机制/归约器类型.html">归约器类型</a></li><li><a class="" href="../../核心引擎设计/状态更新机制/状态更新机制.html">状态更新机制</a></li><li><a class="" href="../../核心引擎设计/状态更新机制/状态模式.html">状态模式</a></li></ul><li class="heading"><span>错误处理与重试</span></li><ul><li><a class="" href="../../核心引擎设计/错误处理与重试/重试执行流程.html">重试执行流程</a></li><li><a class="" href="../../核心引擎设计/错误处理与重试/重试策略配置.html">重试策略配置</a></li><li><a class="" href="../../核心引擎设计/错误处理与重试/错误判定机制.html">错误判定机制</a></li><li><a class="" href="../../核心引擎设计/错误处理与重试/错误处理与重试.html">错误处理与重试</a></li></ul></ul><li class="heading"><span>状态管理架构</span></li><ul><li><a class="" href="../../状态管理架构/临时通道.html">临时通道</a></li><li><a class="" href="../../状态管理架构/归约器.html">归约器</a></li><li><a class="" href="../../状态管理架构/状态管理架构.html">状态管理架构</a></li><li class="heading"><span>状态模式</span></li><ul><li><a class="" href="../../状态管理架构/状态模式/StateSchema 接口.html">StateSchema 接口</a></li><li><a class="" href="../../状态管理架构/状态模式/归约器（Reducer）函数.html">归约器（Reducer）函数</a></li><li><a class="" href="../../状态管理架构/状态模式/状态模式.html">状态模式</a></li><li><a class="" href="../../状态管理架构/状态模式/瞬态通道（Ephemeral Channels）.html">瞬态通道（Ephemeral Channels）</a></li><li class="heading"><span>MapSchema 实现</span></li><ul><li><a class="" href="../../状态管理架构/状态模式/MapSchema 实现/MapSchema 实现.html">MapSchema 实现</a></li><li><a class="" href="../../状态管理架构/状态模式/MapSchema 实现/Reducers 管理机制.html">Reducers 管理机制</a></li><li><a class="" href="../../状态管理架构/状态模式/MapSchema 实现/Update 方法执行流程.html">Update 方法执行流程</a></li><li><a class="" href="../../状态管理架构/状态模式/MapSchema 实现/内置归约器实现.html">内置归约器实现</a></li><li><a class="" href="../../状态管理架构/状态模式/MapSchema 实现/瞬态键（Ephemeral Keys）处理.html">瞬态键（Ephemeral Keys）处理</a></li></ul></ul><li class="heading"><span>通道架构</span></li><ul><li><a class="" href="../../状态管理架构/通道架构/BinaryOperatorChannel.html">BinaryOperatorChannel</a></li><li><a class="" href="../../状态管理架构/通道架构/LastValueChannel.html">LastValueChannel</a></li><li><a class="" href="../../状态管理架构/通道架构/TopicChannel.html">TopicChannel</a></li><li><a class="" href="../../状态管理架构/通道架构/通道架构.html">通道架构</a></li></ul></ul></ul><li class="heading"><span>教程与示例</span></li><ul><li><a class="" href="../../../教程与示例/LLM提供者灵活性.html">LLM提供者灵活性</a></li><li><a class="" href="../../../教程与示例/MCP Agent 示例.html">MCP Agent 示例</a></li><li><a class="" href="../../../教程与示例/人机协作.html">人机协作</a></li><li><a class="" href="../../../教程与示例/基础示例教程.html">基础示例教程</a></li><li><a class="" href="../../../教程与示例/多 Agent 系统指南.html">多 Agent 系统指南</a></li><li><a class="" href="../../../教程与示例/多智能体系统展示.html">多智能体系统展示</a></li><li><a class="" href="../../../教程与示例/并行执行.html">并行执行</a></li><li><a class="" href="../../../教程与示例/技能集成.html">技能集成</a></li><li><a class="" href="../../../教程与示例/教程与示例.html">教程与示例</a></li><li><a class="" href="../../../教程与示例/条件路由与边控制.html">条件路由与边控制</a></li><li><a class="" href="../../../教程与示例/流式输出.html">流式输出</a></li><li class="heading"><span>RAG 示例系列</span></li><ul><li><a class="" href="../../../教程与示例/RAG 示例系列/RAG 示例系列.html">RAG 示例系列</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/基础RAG实现.html">基础RAG实现</a></li><li class="heading"><span>向量存储集成</span></li><ul><li><a class="" href="../../../教程与示例/RAG 示例系列/向量存储集成/Chroma向量库对接.html">Chroma向量库对接</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/向量存储集成/LangChain生态集成.html">LangChain生态集成</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/向量存储集成/向量存储集成.html">向量存储集成</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/向量存储集成/嵌入模型集成.html">嵌入模型集成</a></li></ul><li class="heading"><span>高级RAG模式</span></li><ul><li><a class="" href="../../../教程与示例/RAG 示例系列/高级RAG模式/条件路由与回退机制.html">条件路由与回退机制</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/高级RAG模式/检索后重排序.html">检索后重排序</a></li><li><a class="" href="../../../教程与示例/RAG 示例系列/高级RAG模式/高级RAG模式.html">高级RAG模式</a></li></ul></ul><li class="heading"><span>子图与嵌套工作流</span></li><ul><li><a class="" href="../../../教程与示例/子图与嵌套工作流/单层子图实现.html">单层子图实现</a></li><li><a class="" href="../../../教程与示例/子图与嵌套工作流/多层嵌套工作流.html">多层嵌套工作流</a></li><li><a class="" href="../../../教程与示例/子图与嵌套工作流/子图与嵌套工作流.html">子图与嵌套工作流</a></li></ul><li class="heading"><span>工具集成示例</span></li><ul><li><a class="" href="../../../教程与示例/工具集成示例/MCP 适配器.html">MCP 适配器</a></li><li><a class="" href="../../../教程与示例/工具集成示例/Web搜索工具.html">Web搜索工具</a></li><li><a class="" href="../../../教程与示例/工具集成示例/goskills 适配器.html">goskills 适配器</a></li><li><a class="" href="../../../教程与示例/工具集成示例/工具集成示例.html">工具集成示例</a></li></ul><li class="heading"><span>智能代理示例</span></li><ul><li><a class="" href="../../../教程与示例/智能代理示例/ReAct代理.html">ReAct代理</a></li><li><a class="" href="../../../教程与示例/智能代理示例/代理协调器.html">代理协调器</a></li><li><a class="" href="../../../教程与示例/智能代理示例/代理群.html">代理群</a></li><li><a class="" href="../../../教程与示例/智能代理示例/动态技能系统.html">动态技能系统</a></li><li><a class="" href="../../../教程与示例/智能代理示例/基础代理创建.html">基础代理创建</a></li><li><a class="" href="../../../教程与示例/智能代理示例/智能代理示例.html">智能代理示例</a></li></ul><li class="heading"><span>检查点持久化示例</span></li><ul><li><a class="" href="../../../教程与示例/检查点持久化示例/PostgreSQL 检查点.html">PostgreSQL 检查点</a></li><li><a class="" href="../../../教程与示例/检查点持久化示例/Redis 检查点.html">Redis 检查点</a></li><li><a class="" href="../../../教程与示例/检查点持久化示例/SQLite 检查点.html">SQLite 检查点</a></li><li><a class="" href="../../../教程与示例/检查点持久化示例/检查点持久化示例.html">检查点持久化示例</a></li></ul><li class="heading"><span>状态管理与模式</span></li><ul><li><a class="" href="../../../教程与示例/状态管理与模式/基础内存管理.html">基础内存管理</a></li><li><a class="" href="../../../教程与示例/状态管理与模式/状态模式定义.html">状态模式定义</a></li><li><a class="" href="../../../教程与示例/状态管理与模式/状态管理与模式.html">状态管理与模式</a></li><li><a class="" href="../../../教程与示例/状态管理与模式/自定义Reducer.html">自定义Reducer</a></li></ul><li class="heading"><span>高级特性示例</span></li><ul><li><a class="" href="../../../教程与示例/高级特性示例/高级特性示例.html">高级特性示例</a></li><li class="heading"><span>可视化与调试工具</span></li><ul><li><a class="" href="../../../教程与示例/高级特性示例/可视化与调试工具/可视化与调试工具.html">可视化与调试工具</a></li><li><a class="" href="../../../教程与示例/高级特性示例/可视化与调试工具/图结构可视化.html">图结构可视化</a></li><li><a class="" href="../../../教程与示例/高级特性示例/可视化与调试工具/智能消息与调试支持.html">智能消息与调试支持</a></li></ul><li class="heading"><span>持久化执行与时间旅行</span></li><ul><li><a class="" href="../../../教程与示例/高级特性示例/持久化执行与时间旅行/持久化执行与时间旅行.html">持久化执行与时间旅行</a></li><li><a class="" href="../../../教程与示例/高级特性示例/持久化执行与时间旅行/持久化执行保障.html">持久化执行保障</a></li><li><a class="" href="../../../教程与示例/高级特性示例/持久化执行与时间旅行/时间旅行状态回溯.html">时间旅行状态回溯</a></li></ul><li class="heading"><span>监听器与事件系统</span></li><ul><li><a class="" href="../../../教程与示例/高级特性示例/监听器与事件系统/临时通道管理.html">临时通道管理</a></li><li><a class="" href="../../../教程与示例/高级特性示例/监听器与事件系统/事件监听器机制.html">事件监听器机制</a></li><li><a class="" href="../../../教程与示例/高级特性示例/监听器与事件系统/命令API与运行时控制.html">命令API与运行时控制</a></li><li><a class="" href="../../../教程与示例/高级特性示例/监听器与事件系统/监听器与事件系统.html">监听器与事件系统</a></li></ul></ul></ul><li class="heading"><span>核心概念</span></li><ul><li><a class="" href="../../../核心概念/核心概念.html">核心概念</a></li><li class="heading"><span>图结构工作流</span></li><ul><li><a class="" href="../../../核心概念/图结构工作流/入口点.html">入口点</a></li><li><a class="" href="../../../核心概念/图结构工作流/图结构工作流.html">图结构工作流</a></li><li><a class="" href="../../../核心概念/图结构工作流/子图.html">子图</a></li><li><a class="" href="../../../核心概念/图结构工作流/并行执行.html">并行执行</a></li><li><a class="" href="../../../核心概念/图结构工作流/条件边.html">条件边</a></li><li><a class="" href="../../../核心概念/图结构工作流/节点.html">节点</a></li><li><a class="" href="../../../核心概念/图结构工作流/边.html">边</a></li></ul><li class="heading"><span>持久化检查点</span></li><ul><li><a class="" href="../../../核心概念/持久化检查点/持久化检查点.html">持久化检查点</a></li><li><a class="" href="../../../核心概念/持久化检查点/检查点存储接口.html">检查点存储接口</a></li><li><a class="" href="../../../核心概念/持久化检查点/检查点数据模型.html">检查点数据模型</a></li><li><a class="" href="../../../核心概念/持久化检查点/检查点监听器.html">检查点监听器</a></li><li><a class="" href="../../../核心概念/持久化检查点/检查点配置.html">检查点配置</a></li><li class="heading"><span>内置存储实现</span></li><ul><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/PostgreSQL 存储 (PostgresCheckpointStore).html">PostgreSQL 存储 (PostgresCheckpointStore)</a></li><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/Redis 存储 (RedisCheckpointStore).html">Redis 存储 (RedisCheckpointStore)</a></li><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/SQLite 存储 (SqliteCheckpointStore).html">SQLite 存储 (SqliteCheckpointStore)</a></li><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/内存存储 (MemoryCheckpointStore).html">内存存储 (MemoryCheckpointStore)</a></li><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/内置存储实现.html">内置存储实现</a></li><li><a class="" href="../../../核心概念/持久化检查点/内置存储实现/文件存储 (FileCheckpointStore).html">文件存储 (FileCheckpointStore)</a></li></ul></ul><li class="heading"><span>流式输出</span></li><ul><li><a class="" href="../../../核心概念/流式输出/事件通道与结果处理.html">事件通道与结果处理</a></li><li><a class="" href="../../../核心概念/流式输出/流式执行器.html">流式执行器</a></li><li><a class="" href="../../../核心概念/流式输出/流式模式.html">流式模式</a></li><li><a class="" href="../../../核心概念/流式输出/流式监听器.html">流式监听器</a></li><li><a class="" href="../../../核心概念/流式输出/流式输出.html">流式输出</a></li><li><a class="" href="../../../核心概念/流式输出/流式配置.html">流式配置</a></li></ul><li class="heading"><span>状态管理</span></li><ul><li><a class="" href="../../../核心概念/状态管理/状态归约器.html">状态归约器</a></li><li><a class="" href="../../../核心概念/状态管理/状态模式.html">状态模式</a></li><li><a class="" href="../../../核心概念/状态管理/状态管理.html">状态管理</a></li><li><a class="" href="../../../核心概念/状态管理/瞬态通道.html">瞬态通道</a></li></ul><li class="heading"><span>监听器</span></li><ul><li><a class="" href="../../../核心概念/监听器/可监听可运行实例.html">可监听可运行实例</a></li><li><a class="" href="../../../核心概念/监听器/图回调处理器.html">图回调处理器</a></li><li><a class="" href="../../../核心概念/监听器/监听器.html">监听器</a></li><li><a class="" href="../../../核心概念/监听器/监听器接口.html">监听器接口</a></li><li><a class="" href="../../../核心概念/监听器/节点事件类型.html">节点事件类型</a></li><li class="heading"><span>可监听图</span></li><ul><li><a class="" href="../../../核心概念/监听器/可监听图/全局监听器.html">全局监听器</a></li><li><a class="" href="../../../核心概念/监听器/可监听图/可监听图.html">可监听图</a></li><li><a class="" href="../../../核心概念/监听器/可监听图/可监听图构建.html">可监听图构建</a></li><li><a class="" href="../../../核心概念/监听器/可监听图/可监听节点管理.html">可监听节点管理</a></li></ul><li class="heading"><span>可监听节点</span></li><ul><li><a class="" href="../../../核心概念/监听器/可监听节点/事件通知机制.html">事件通知机制</a></li><li><a class="" href="../../../核心概念/监听器/可监听节点/可监听节点.html">可监听节点</a></li><li><a class="" href="../../../核心概念/监听器/可监听节点/可监听节点构造器.html">可监听节点构造器</a></li><li><a class="" href="../../../核心概念/监听器/可监听节点/监听器管理机制.html">监听器管理机制</a></li></ul></ul></ul><li class="heading"><span>预构建组件</span></li><ul><li><a class="" href="../../../预构建组件/Create Agent.html">Create Agent</a></li><li><a class="" href="../../../预构建组件/ReAct Agent.html">ReAct Agent</a></li><li><a class="" href="../../../预构建组件/Supervisor.html">Supervisor</a></li><li><a class="" href="../../../预构建组件/预构建组件.html">预构建组件</a></li><li class="heading"><span>RAG 组件</span></li><ul><li><a class="" href="../../../预构建组件/RAG 组件/RAG 组件.html">RAG 组件</a></li><li><a class="" href="../../../预构建组件/RAG 组件/基础 RAG.html">基础 RAG</a></li><li><a class="" href="../../../预构建组件/RAG 组件/条件 RAG.html">条件 RAG</a></li><li class="heading"><span>高级 RAG</span></li><ul><li><a class="" href="../../../预构建组件/RAG 组件/高级 RAG/引用格式化.html">引用格式化</a></li><li><a class="" href="../../../预构建组件/RAG 组件/高级 RAG/重排序机制.html">重排序机制</a></li><li><a class="" href="../../../预构建组件/RAG 组件/高级 RAG/高级 RAG.html">高级 RAG</a></li></ul></ul></ul><li class="heading"><span>检查点存储</span></li><ul><li><a class="" href="../../../检查点存储/PostgreSQL 检查点存储.html">PostgreSQL 检查点存储</a></li><li><a class="" href="../../../检查点存储/Redis 检查点存储.html">Redis 检查点存储</a></li><li><a class="" href="../../../检查点存储/SQLite 检查点存储.html">SQLite 检查点存储</a></li><li><a class="" href="../../../检查点存储/检查点存储.html">检查点存储</a></li></ul><li class="heading"><span>工具集成</span></li><ul><li><a class="" href="../../../工具集成/具体工具集成.html">具体工具集成</a></li><li><a class="" href="../../../工具集成/工具执行框架.html">工具执行框架</a></li><li><a class="" href="../../../工具集成/工具集成.html">工具集成</a></li></ul><li class="heading"><span>高级特性</span></li><ul><li><a class="" href="../../../高级特性/人机协作.html">人机协作</a></li><li><a class="" href="../../../高级特性/可视化.html">可视化</a></li><li><a class="" href="../../../高级特性/子图.html">子图</a></li><li><a class="" href="../../../高级特性/并行执行.html">并行执行</a></li><li><a class="" href="../../../高级特性/高级特性.html">高级特性</a></li></ul><li class="heading"><span>API 参考</span></li><ul><li><a class="" href="../../../API 参考/API 参考.html">API 参考</a></li><li><a class="" href="../../../API 参考/工具集成.html">工具集成</a></li><li><a class="" href="../../../API 参考/流式处理模块.html">流式处理模块</a></li><li class="heading"><span>图引擎</span></li><ul><li><a class="" href="../../../API 参考/图引擎/图定义.html">图定义</a></li><li><a class="" href="../../../API 参考/图引擎/图引擎.html">图引擎</a></li><li><a class="" href="../../../API 参考/图引擎/状态图.html">状态图</a></li><li class="heading"><span>图执行</span></li><ul><li><a class="" href="../../../API 参考/图引擎/图执行/图执行.html">图执行</a></li><li><a class="" href="../../../API 参考/图引擎/图执行/并行执行.html">并行执行</a></li><li><a class="" href="../../../API 参考/图引擎/图执行/执行中断.html">执行中断</a></li><li><a class="" href="../../../API 参考/图引擎/图执行/错误重试策略.html">错误重试策略</a></li></ul></ul><li class="heading"><span>检查点模块</span></li><ul><li><a class="" href="../../../API 参考/检查点模块/CheckpointStore 接口.html">CheckpointStore 接口</a></li><li><a class="" href="../../../API 参考/检查点模块/PostgreSQL 检查点存储.html">PostgreSQL 检查点存储</a></li><li><a class="" href="../../../API 参考/检查点模块/Redis 检查点存储.html">Redis 检查点存储</a></li><li><a class="" href="../../../API 参考/检查点模块/SQLite 检查点存储.html">SQLite 检查点存储</a></li><li><a class="" href="../../../API 参考/检查点模块/检查点模块.html">检查点模块</a></li></ul><li class="heading"><span>预构建组件</span></li><ul><li><a class="" href="../../../API 参考/预构建组件/协调器 (Supervisor).html">协调器 (Supervisor)</a></li><li><a class="" href="../../../API 参考/预构建组件/智能代理 (CreateAgent).html">智能代理 (CreateAgent)</a></li><li><a class="" href="../../../API 参考/预构建组件/检索增强生成 (RAG).html">检索增强生成 (RAG)</a></li><li><a class="" href="../../../API 参考/预构建组件/预构建组件.html">预构建组件</a></li></ul></ul></ul>
</nav>
<article class="content" id="main">
<h1 id="%E7%9B%91%E5%90%AC%E5%99%A8%E7%B3%BB%E7%BB%9F">监听器系统 <a class="heading-anchor-permalink" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E7%B3%BB%E7%BB%9F">#</a></h1>
<div class="cite-content">
<p><strong>本文档中引用的文件</strong></p>
<ul>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go">graph/listeners.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go">graph/builtin_listeners.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go">graph/streaming.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/callbacks.go">graph/callbacks.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/schema.go">graph/schema.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/examples/listeners/main.go">examples/listeners/main.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/examples/basic_example/main.go">examples/basic_example/main.go</a></li>
<li><a href="https://github.com/smallnest/langgraphgo/blob/main/graph/listeners_test.go">graph/listeners_test.go</a></li>
</ul>
</div>
<h2 id="%E7%9B%AE%E5%BD%95">目录 <a class="heading-anchor-permalink" href="#%E7%9B%AE%E5%BD%95">#</a></h2>
<ol>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%B8%8E%E7%B1%BB%E5%9E%8B">核心接口与类型</a></li>
<li><a href="#%E5%86%85%E7%BD%AE%E7%9B%91%E5%90%AC%E5%99%A8">内置监听器</a></li>
<li><a href="#%E5%8F%AF%E7%9B%91%E5%90%AC%E7%BB%84%E4%BB%B6">可监听组件</a></li>
<li><a href="#%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%9B%91%E5%90%AC%E5%99%A8">流式处理监听器</a></li>
<li><a href="#%E5%9B%9E%E8%B0%83%E5%A4%84%E7%90%86%E5%99%A8%E7%B3%BB%E7%BB%9F">回调处理器系统</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">使用示例</a></li>
<li><a href="#%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6">异步执行机制</a></li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5">错误处理策略</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
</ol>
<h2 id="%E7%AE%80%E4%BB%8B">简介 <a class="heading-anchor-permalink" href="#%E7%AE%80%E4%BB%8B">#</a></h2>
<p>LangGraphGo 的监听器系统是一个强大的事件驱动架构，允许开发者在图执行过程中的各个阶段捕获和响应事件。该系统提供了灵活的扩展机制，支持日志记录、进度追踪、性能监控和自定义业务逻辑的实现。</p>
<p>监听器系统的核心设计理念是：</p>
<ul>
<li><strong>非侵入性</strong>：监听器不会干扰主执行流程</li>
<li><strong>异步执行</strong>：监听器通知在独立的 goroutine 中执行</li>
<li><strong>类型安全</strong>：强类型的事件系统确保编译时安全性</li>
<li><strong>可扩展性</strong>：支持多种内置监听器和自定义实现</li>
</ul>
<h2 id="%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%B8%8E%E7%B1%BB%E5%9E%8B">核心接口与类型 <a class="heading-anchor-permalink" href="#%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%B8%8E%E7%B1%BB%E5%9E%8B">#</a></h2>
<h3 id="nodeevent-%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B">NodeEvent 事件类型 <a class="heading-anchor-permalink" href="#nodeevent-%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B">#</a></h3>
<p>监听器系统定义了丰富的事件类型来表示图执行的不同阶段：</p>
<pre><code class="language-mermaid">graph TD
A[NodeEvent] --&gt; B[NodeEventStart&lt;br/&gt;节点开始执行]
A --&gt; C[NodeEventProgress&lt;br/&gt;节点进度更新]
A --&gt; D[NodeEventComplete&lt;br/&gt;节点成功完成]
A --&gt; E[NodeEventError&lt;br/&gt;节点执行出错]
F[GraphEvent] --&gt; G[EventChainStart&lt;br/&gt;图执行开始]
F --&gt; H[EventChainEnd&lt;br/&gt;图执行结束]
I[ToolEvent] --&gt; J[EventToolStart&lt;br/&gt;工具调用开始]
I --&gt; K[EventToolEnd&lt;br/&gt;工具调用结束]
L[LLMEvent] --&gt; M[EventLLMStart&lt;br/&gt;LLM调用开始]
L --&gt; N[EventLLMEnd&lt;br/&gt;LLM调用结束]
O[StreamingEvent] --&gt; P[EventToken&lt;br/&gt;生成令牌]
O --&gt; Q[EventCustom&lt;br/&gt;自定义事件]
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L13-L48)</li>
</ul>
<h3 id="nodelistener-%E6%8E%A5%E5%8F%A3">NodeListener 接口 <a class="heading-anchor-permalink" href="#nodelistener-%E6%8E%A5%E5%8F%A3">#</a></h3>
<p><code>NodeListener</code> 是监听器系统的核心接口，定义了事件处理的标准契约：</p>
<pre><code class="language-mermaid">classDiagram
class NodeListener {
&lt;&lt;interface&gt;&gt;
+OnNodeEvent(ctx Context, event NodeEvent, nodeName string, state interface, err error)
}
class NodeListenerFunc {
+func(ctx Context, event NodeEvent, nodeName string, state interface, err error)
}
NodeListenerFunc ..|&gt; NodeListener : 实现
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L51-L63)</li>
</ul>
<h3 id="streamevent-%E7%BB%93%E6%9E%84%E4%BD%93">StreamEvent 结构体 <a class="heading-anchor-permalink" href="#streamevent-%E7%BB%93%E6%9E%84%E4%BD%93">#</a></h3>
<p><code>StreamEvent</code> 提供了详细的事件信息，用于流式处理和事件传递：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>time.Time</td>
<td>事件发生的时间戳</td>
</tr>
<tr>
<td>NodeName</td>
<td>string</td>
<td>生成事件的节点名称</td>
</tr>
<tr>
<td>Event</td>
<td>NodeEvent</td>
<td>事件类型标识符</td>
</tr>
<tr>
<td>State</td>
<td>interface{}</td>
<td>当前状态快照</td>
</tr>
<tr>
<td>Error</td>
<td>error</td>
<td>错误信息（如果适用）</td>
</tr>
<tr>
<td>Metadata</td>
<td>map[string]interface{}</td>
<td>额外的元数据</td>
</tr>
<tr>
<td>Duration</td>
<td>time.Duration</td>
<td>执行持续时间（仅完成事件）</td>
</tr>
</tbody>
</table>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L66-L87)</li>
</ul>
<h2 id="%E5%86%85%E7%BD%AE%E7%9B%91%E5%90%AC%E5%99%A8">内置监听器 <a class="heading-anchor-permalink" href="#%E5%86%85%E7%BD%AE%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h2>
<p>LangGraphGo 提供了多种预构建的监听器，满足常见的监控和调试需求：</p>
<h3 id="progresslistener-%E8%BF%9B%E5%BA%A6%E7%9B%91%E5%90%AC%E5%99%A8">ProgressListener 进度监听器 <a class="heading-anchor-permalink" href="#progresslistener-%E8%BF%9B%E5%BA%A6%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h3>
<p>提供可视化的进度跟踪功能：</p>
<pre><code class="language-mermaid">classDiagram
class ProgressListener {
-writer io.Writer
-nodeSteps map[string]string
-mutex sync.RWMutex
-showTiming bool
-showDetails bool
-prefix string
+SetNodeStep(nodeName, step string)
+WithTiming(enabled bool) ProgressListener
+WithDetails(enabled bool) ProgressListener
+WithPrefix(prefix string) ProgressListener
}
class NodeListener {
&lt;&lt;interface&gt;&gt;
+OnNodeEvent(ctx Context, event NodeEvent, nodeName string, state interface, err error)
}
ProgressListener ..|&gt; NodeListener : 实现
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/builtin_listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go#L14-L68)</li>
</ul>
<h3 id="logginglistener-%E6%97%A5%E5%BF%97%E7%9B%91%E5%90%AC%E5%99%A8">LoggingListener 日志监听器 <a class="heading-anchor-permalink" href="#logginglistener-%E6%97%A5%E5%BF%97%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h3>
<p>提供结构化的日志记录功能：</p>
<pre><code class="language-mermaid">classDiagram
class LoggingListener {
-logger *log.Logger
-logLevel LogLevel
-includeState bool
+WithLogLevel(level LogLevel) LoggingListener
+WithState(enabled bool) LoggingListener
}
class LogLevel {
&lt;&lt;enumeration&gt;&gt;
LogLevelDebug
LogLevelInfo
LogLevelWarn
LogLevelError
}
LoggingListener --&gt; LogLevel : 使用
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/builtin_listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go#L118-L200)</li>
</ul>
<h3 id="metricslistener-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E5%90%AC%E5%99%A8">MetricsListener 性能指标监听器 <a class="heading-anchor-permalink" href="#metricslistener-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h3>
<p>收集详细的性能和执行统计信息：</p>
<pre><code class="language-mermaid">classDiagram
class MetricsListener {
-mutex sync.RWMutex
-nodeExecutions map[string]int
-nodeDurations map[string][]time.Duration
-nodeErrors map[string]int
-totalExecutions int
-startTimes map[string]time.Time
+GetNodeExecutions() map[string]int
+GetNodeErrors() map[string]int
+GetNodeAverageDuration() map[string]time.Duration
+GetTotalExecutions() int
+PrintSummary(writer io.Writer)
+Reset()
}
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/builtin_listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go#L202-L351)</li>
</ul>
<h3 id="chatlistener-%E8%81%8A%E5%A4%A9%E9%A3%8E%E6%A0%BC%E7%9B%91%E5%90%AC%E5%99%A8">ChatListener 聊天风格监听器 <a class="heading-anchor-permalink" href="#chatlistener-%E8%81%8A%E5%A4%A9%E9%A3%8E%E6%A0%BC%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h3>
<p>提供实时的聊天式更新体验：</p>
<pre><code class="language-mermaid">classDiagram
class ChatListener {
-writer io.Writer
-nodeMessages map[string]string
-mutex sync.RWMutex
-showTime bool
+SetNodeMessage(nodeName, message string)
+WithTime(enabled bool) ChatListener
}
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/builtin_listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go#L353-L432)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/builtin_listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/builtin_listeners.go#L14-L433)</li>
</ul>
<h2 id="%E5%8F%AF%E7%9B%91%E5%90%AC%E7%BB%84%E4%BB%B6">可监听组件 <a class="heading-anchor-permalink" href="#%E5%8F%AF%E7%9B%91%E5%90%AC%E7%BB%84%E4%BB%B6">#</a></h2>
<h3 id="listenablenode-%E5%8F%AF%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9">ListenableNode 可监听节点 <a class="heading-anchor-permalink" href="#listenablenode-%E5%8F%AF%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9">#</a></h3>
<p><code>ListenableNode</code> 为单个节点添加监听能力：</p>
<pre><code class="language-mermaid">sequenceDiagram
participant Client as 客户端
participant LN as ListenableNode
participant Listener as 监听器
participant Node as 原始节点
Client-&gt;&gt;LN : Execute(ctx, state)
LN-&gt;&gt;LN : NotifyListeners(start, state, nil)
LN-&gt;&gt;Listener : OnNodeEvent(start, nodeName, state, nil)
LN-&gt;&gt;Node : Function(ctx, state)
Node--&gt;&gt;LN : result/error
alt 成功执行
LN-&gt;&gt;LN : NotifyListeners(complete, result, nil)
LN-&gt;&gt;Listener : OnNodeEvent(complete, nodeName, result, nil)
else 执行失败
LN-&gt;&gt;LN : NotifyListeners(error, state, error)
LN-&gt;&gt;Listener : OnNodeEvent(error, nodeName, state, error)
end
LN--&gt;&gt;Client : result/error
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L159-L175)</li>
</ul>
<h3 id="listenablemessagegraph-%E5%8F%AF%E7%9B%91%E5%90%AC%E6%B6%88%E6%81%AF%E5%9B%BE">ListenableMessageGraph 可监听消息图 <a class="heading-anchor-permalink" href="#listenablemessagegraph-%E5%8F%AF%E7%9B%91%E5%90%AC%E6%B6%88%E6%81%AF%E5%9B%BE">#</a></h3>
<p>扩展整个消息图的监听能力：</p>
<pre><code class="language-mermaid">classDiagram
class ListenableMessageGraph {
+*MessageGraph
+listenableNodes map[string]*ListenableNode
+AddNode(name string, fn func) *ListenableNode
+GetListenableNode(name string) *ListenableNode
+AddGlobalListener(listener NodeListener)
+RemoveGlobalListener(listener NodeListener)
}
class ListenableNode {
+Node
+listeners []NodeListener
+mutex sync.RWMutex
+AddListener(listener NodeListener) ListenableNode
+RemoveListener(listener NodeListener)
+NotifyListeners(ctx Context, event NodeEvent, state interface, err error)
}
ListenableMessageGraph --&gt; ListenableNode : 包含
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L187-L234)</li>
</ul>
<h3 id="listenablerunnable-%E5%8F%AF%E7%9B%91%E5%90%AC%E5%8F%AF%E8%BF%90%E8%A1%8C%E5%AF%B9%E8%B1%A1">ListenableRunnable 可监听可运行对象 <a class="heading-anchor-permalink" href="#listenablerunnable-%E5%8F%AF%E7%9B%91%E5%90%AC%E5%8F%AF%E8%BF%90%E8%A1%8C%E5%AF%B9%E8%B1%A1">#</a></h3>
<p>提供完整的监听器支持的图执行能力：</p>
<pre><code class="language-mermaid">flowchart TD
A[ListenableRunnable] --&gt; B[Invoke]
A --&gt; C[InvokeWithConfig]
A --&gt; D[GetGraph]
B --&gt; E[执行图]
C --&gt; E
E --&gt; F[遍历节点]
F --&gt; G[执行每个节点]
G --&gt; H[通知监听器]
H --&gt; I[更新状态]
I --&gt; J{是否有下一个节点?}
J --&gt; |是| F
J --&gt; |否| K[返回最终结果]
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L254-L329)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L89-L335)</li>
</ul>
<h2 id="%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%9B%91%E5%90%AC%E5%99%A8">流式处理监听器 <a class="heading-anchor-permalink" href="#%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h2>
<h3 id="streaminglistener-%E6%B5%81%E5%BC%8F%E7%9B%91%E5%90%AC%E5%99%A8">StreamingListener 流式监听器 <a class="heading-anchor-permalink" href="#streaminglistener-%E6%B5%81%E5%BC%8F%E7%9B%91%E5%90%AC%E5%99%A8">#</a></h3>
<p>专门设计用于实时事件流处理的监听器：</p>
<pre><code class="language-mermaid">classDiagram
class StreamingListener {
-eventChan chan~StreamEvent~
-config StreamConfig
-mutex sync.RWMutex
-droppedEvents int
-closed bool
+emitEvent(event StreamEvent)
+shouldEmit(event StreamEvent) bool
+handleBackpressure()
+Close()
+GetDroppedEventsCount() int
}
class StreamConfig {
+BufferSize int
+EnableBackpressure bool
+MaxDroppedEvents int
+Mode StreamMode
}
class StreamMode {
&lt;&lt;enumeration&gt;&gt;
StreamModeValues
StreamModeUpdates
StreamModeMessages
StreamModeDebug
}
StreamingListener --&gt; StreamConfig : 使用
StreamConfig --&gt; StreamMode : 包含
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L66-L135)</li>
</ul>
<h3 id="streamresult-%E6%B5%81%E5%BC%8F%E7%BB%93%E6%9E%9C">StreamResult 流式结果 <a class="heading-anchor-permalink" href="#streamresult-%E6%B5%81%E5%BC%8F%E7%BB%93%E6%9E%9C">#</a></h3>
<p>封装流式执行的所有输出通道：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Events</td>
<td>&lt;-chan StreamEvent</td>
<td>实时事件流</td>
</tr>
<tr>
<td>Result</td>
<td>&lt;-chan interface{}</td>
<td>最终执行结果</td>
</tr>
<tr>
<td>Errors</td>
<td>&lt;-chan error</td>
<td>执行过程中发生的错误</td>
</tr>
<tr>
<td>Done</td>
<td>&lt;-chan struct{}</td>
<td>执行完成信号</td>
</tr>
<tr>
<td>Cancel</td>
<td>context.CancelFunc</td>
<td>取消执行的方法</td>
</tr>
</tbody>
</table>
<h3 id="streamingrunnable-%E6%B5%81%E5%BC%8F%E5%8F%AF%E8%BF%90%E8%A1%8C%E5%AF%B9%E8%B1%A1">StreamingRunnable 流式可运行对象 <a class="heading-anchor-permalink" href="#streamingrunnable-%E6%B5%81%E5%BC%8F%E5%8F%AF%E8%BF%90%E8%A1%8C%E5%AF%B9%E8%B1%A1">#</a></h3>
<p>提供流式执行能力的包装器：</p>
<pre><code class="language-mermaid">sequenceDiagram
participant Client as 客户端
participant SR as StreamingRunnable
participant SL as StreamingListener
participant Nodes as 图节点
Client-&gt;&gt;SR : Stream(ctx, initialState)
SR-&gt;&gt;SL : 创建流式监听器
SR-&gt;&gt;Nodes : 添加监听器到所有节点
SR-&gt;&gt;SR : 在goroutine中执行
loop 执行过程
Nodes-&gt;&gt;SL : emitEvent(event)
SL-&gt;&gt;SL : 处理背压
SL-&gt;&gt;Client : 发送到事件通道
end
SR-&gt;&gt;Client : 返回StreamResult
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L289-L358)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L66-L476)</li>
</ul>
<h2 id="%E5%9B%9E%E8%B0%83%E5%A4%84%E7%90%86%E5%99%A8%E7%B3%BB%E7%BB%9F">回调处理器系统 <a class="heading-anchor-permalink" href="#%E5%9B%9E%E8%B0%83%E5%A4%84%E7%90%86%E5%99%A8%E7%B3%BB%E7%BB%9F">#</a></h2>
<h3 id="callbackhandler-%E5%9B%9E%E8%B0%83%E5%A4%84%E7%90%86%E5%99%A8">CallbackHandler 回调处理器 <a class="heading-anchor-permalink" href="#callbackhandler-%E5%9B%9E%E8%B0%83%E5%A4%84%E7%90%86%E5%99%A8">#</a></h3>
<p>定义了完整的回调处理接口，支持链、LLM、工具和检索器事件：</p>
<pre><code class="language-mermaid">classDiagram
class CallbackHandler {
&lt;&lt;interface&gt;&gt;
+OnChainStart(ctx, serialized, inputs, runID, parentRunID, tags, metadata)
+OnChainEnd(ctx, outputs, runID)
+OnChainError(ctx, err, runID)
+OnLLMStart(ctx, serialized, prompts, runID, parentRunID, tags, metadata)
+OnLLMEnd(ctx, response, runID)
+OnLLMError(ctx, err, runID)
+OnToolStart(ctx, serialized, inputStr, runID, parentRunID, tags, metadata)
+OnToolEnd(ctx, output, runID)
+OnToolError(ctx, err, runID)
+OnRetrieverStart(ctx, serialized, query, runID, parentRunID, tags, metadata)
+OnRetrieverEnd(ctx, documents, runID)
+OnRetrieverError(ctx, err, runID)
}
class GraphCallbackHandler {
&lt;&lt;interface&gt;&gt;
+OnGraphStep(ctx, stepNode, state)
}
GraphCallbackHandler --|&gt; CallbackHandler : 继承
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/callbacks.go](https://github.com/smallnest/langgraphgo/blob/main/graph/callbacks.go#L8-L37)</li>
</ul>
<h3 id="config-%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84">Config 配置结构 <a class="heading-anchor-permalink" href="#config-%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84">#</a></h3>
<p>提供灵活的执行配置选项：</p>
<pre><code class="language-mermaid">classDiagram
class Config {
+Callbacks []CallbackHandler
+Metadata map[string]interface
+Tags []string
+Configurable map[string]interface
+RunName string
+Timeout *time.Duration
+InterruptBefore []string
+InterruptAfter []string
+ResumeFrom []string
+ResumeValue interface
}
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/callbacks.go](https://github.com/smallnest/langgraphgo/blob/main/graph/callbacks.go#L39-L71)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/callbacks.go](https://github.com/smallnest/langgraphgo/blob/main/graph/callbacks.go#L8-L94)</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">使用示例 <a class="heading-anchor-permalink" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">#</a></h2>
<h3 id="%E5%9F%BA%E6%9C%AC%E7%9B%91%E5%90%AC%E5%99%A8%E4%BD%BF%E7%94%A8">基本监听器使用 <a class="heading-anchor-permalink" href="#%E5%9F%BA%E6%9C%AC%E7%9B%91%E5%90%AC%E5%99%A8%E4%BD%BF%E7%94%A8">#</a></h3>
<p>以下展示了如何创建和注册不同类型的监听器：</p>
<pre><code class="language-mermaid">sequenceDiagram
participant Main as 主程序
participant Graph as ListenableMessageGraph
participant Process as process节点
participant Analyze as analyze节点
participant Report as report节点
participant Progress as ProgressListener
participant Metrics as MetricsListener
participant Logging as LoggingListener
Main-&gt;&gt;Graph : 创建图
Main-&gt;&gt;Graph : 添加节点
Main-&gt;&gt;Progress : 创建进度监听器
Main-&gt;&gt;Metrics : 创建指标监听器
Main-&gt;&gt;Logging : 创建日志监听器
Main-&gt;&gt;Process : AddListener(Progress)
Main-&gt;&gt;Process : AddListener(Metrics)
Main-&gt;&gt;Process : AddListener(Logging)
Main-&gt;&gt;Analyze : AddListener(Progress)
Main-&gt;&gt;Analyze : AddListener(Metrics)
Main-&gt;&gt;Analyze : AddListener(Logging)
Main-&gt;&gt;Report : AddListener(Progress)
Main-&gt;&gt;Report : AddListener(Metrics)
Main-&gt;&gt;Report : AddListener(Logging)
Main-&gt;&gt;Graph : 编译图
Main-&gt;&gt;Graph : 执行图
Note over Progress,Logging : 各监听器异步接收事件
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[examples/listeners/main.go](https://github.com/smallnest/langgraphgo/blob/main/examples/listeners/main.go#L31-L64)</li>
</ul>
<h3 id="%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%A4%BA%E4%BE%8B">流式处理示例 <a class="heading-anchor-permalink" href="#%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%A4%BA%E4%BE%8B">#</a></h3>
<p>演示如何使用流式监听器实现实时事件处理：</p>
<pre><code class="language-mermaid">flowchart TD
A[创建StreamingMessageGraph] --&gt; B[添加节点和边]
B --&gt; C[编译为StreamingRunnable]
C --&gt; D[创建StreamConfig]
D --&gt; E[设置流模式]
E --&gt; F[创建StreamingExecutor]
F --&gt; G[ExecuteWithCallback]
G --&gt; H[事件回调函数]
G --&gt; I[结果回调函数]
H --&gt; J[处理StreamEvent]
I --&gt; K[处理最终结果]
J --&gt; L[实时显示进度]
J --&gt; M[记录性能指标]
J --&gt; N[生成日志]
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L402-L467)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[examples/listeners/main.go](https://github.com/smallnest/langgraphgo/blob/main/examples/listeners/main.go#L1-132)</li>
<li>[examples/basic_example/main.go](https://github.com/smallnest/langgraphgo/blob/main/examples/basic_example/main.go#L44-L62)</li>
</ul>
<h2 id="%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6">异步执行机制 <a class="heading-anchor-permalink" href="#%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6">#</a></h2>
<h3 id="%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B">并发模型 <a class="heading-anchor-permalink" href="#%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B">#</a></h3>
<p>监听器系统采用异步并发模型确保主执行流程不受影响：</p>
<pre><code class="language-mermaid">sequenceDiagram
participant Node as 节点执行
participant LN as ListenableNode
participant WG as WaitGroup
participant Listener1 as 监听器1
participant Listener2 as 监听器2
participant ListenerN as 监听器N
Node-&gt;&gt;LN : 执行完成
LN-&gt;&gt;LN : NotifyListeners()
LN-&gt;&gt;WG : Add(监听器数量)
par 并行通知所有监听器
LN-&gt;&gt;Listener1 : OnNodeEvent() (goroutine)
LN-&gt;&gt;Listener2 : OnNodeEvent() (goroutine)
LN-&gt;&gt;ListenerN : OnNodeEvent() (goroutine)
end
Listener1--&gt;&gt;WG : Done()
Listener2--&gt;&gt;WG : Done()
ListenerN--&gt;&gt;WG : Done()
WG--&gt;&gt;LN : Wait() 所有监听器完成
LN--&gt;&gt;Node : 继续执行
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L127-L157)</li>
</ul>
<h3 id="%E9%94%81%E6%9C%BA%E5%88%B6">锁机制 <a class="heading-anchor-permalink" href="#%E9%94%81%E6%9C%BA%E5%88%B6">#</a></h3>
<p>使用读写锁确保线程安全：</p>
<pre><code class="language-mermaid">classDiagram
class ListenableNode {
+listeners []NodeListener
+mutex sync.RWMutex
+AddListener(listener NodeListener) ListenableNode
+RemoveListener(listener NodeListener)
+GetListeners() []NodeListener
+NotifyListeners(ctx Context, event NodeEvent, state interface, err error)
}
note for ListenableNode "读操作使用RWMutex.RLock()\n写操作使用RWMutex.Lock()"
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L92-L94)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L127-L157)</li>
</ul>
<h2 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5">错误处理策略 <a class="heading-anchor-permalink" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5">#</a></h2>
<h3 id="%E7%9B%91%E5%90%AC%E5%99%A8%E5%BC%82%E5%B8%B8%E6%81%A2%E5%A4%8D">监听器异常恢复 <a class="heading-anchor-permalink" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E5%BC%82%E5%B8%B8%E6%81%A2%E5%A4%8D">#</a></h3>
<p>系统实现了完善的错误恢复机制：</p>
<pre><code class="language-mermaid">flowchart TD
A[监听器通知开始] --&gt; B{监听器是否正常?}
B --&gt; |是| C[执行OnNodeEvent]
B --&gt; |否| D[捕获panic]
C --&gt; E{执行是否成功?}
E --&gt; |是| F[继续下一个监听器]
E --&gt; |否| G[记录错误但不中断]
D --&gt; H[恢复panic]
H --&gt; I[记录警告但不中断]
F --&gt; J{还有监听器?}
G --&gt; J
I --&gt; J
J --&gt; |是| C
J --&gt; |否| K[等待组完成]
K --&gt; L[通知完成]
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L140-L152)</li>
</ul>
<h3 id="%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E8%83%8C%E5%8E%8B%E7%AE%A1%E7%90%86">流式处理背压管理 <a class="heading-anchor-permalink" href="#%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E8%83%8C%E5%8E%8B%E7%AE%A1%E7%90%86">#</a></h3>
<p>流式监听器实现了智能的背压处理：</p>
<pre><code class="language-mermaid">flowchart TD
A[发送事件] --&gt; B{通道是否满?}
B --&gt; |否| C[直接发送]
B --&gt; |是| D{启用背压处理?}
D --&gt; |否| E[丢弃事件]
D --&gt; |是| F[handleBackpressure]
F --&gt; G[增加droppedEvents计数]
G --&gt; H{超过最大丢弃限制?}
H --&gt; |是| I[记录警告]
H --&gt; |否| J[继续处理]
E --&gt; K[继续发送下一个事件]
I --&gt; K
J --&gt; K
C --&gt; K
</code></pre>
<p><strong>图表来源</strong></p>
<ul>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L84-L109)</li>
</ul>
<p><strong>节来源</strong></p>
<ul>
<li>[graph/listeners.go](https://github.com/smallnest/langgraphgo/blob/main/graph/listeners.go#L140-L152)</li>
<li>[graph/streaming.go](https://github.com/smallnest/langgraphgo/blob/main/graph/streaming.go#L252-L261)</li>
</ul>
<h2 id="%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践 <a class="heading-anchor-permalink" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">#</a></h2>
<h3 id="%E7%9B%91%E5%90%AC%E5%99%A8%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">监听器设计原则 <a class="heading-anchor-permalink" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">#</a></h3>
<ol>
<li><strong>轻量级</strong>：监听器应该快速执行，避免长时间阻塞</li>
<li><strong>幂等性</strong>：多次调用同一监听器不应产生副作用</li>
<li><strong>无状态</strong>：尽量保持监听器无状态，便于并发使用</li>
<li><strong>错误隔离</strong>：监听器内部错误不应影响主流程</li>
</ol>
<h3 id="%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">性能优化建议 <a class="heading-anchor-permalink" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">#</a></h3>
<ol>
<li><strong>批量处理</strong>：对于大量事件，考虑批量处理而非逐个处理</li>
<li><strong>缓冲区大小</strong>：合理设置流式处理的缓冲区大小</li>
<li><strong>选择合适的监听器</strong>：根据需求选择最适合的内置监听器</li>
<li><strong>资源清理</strong>：及时移除不再需要的监听器以释放资源</li>
</ol>
<h3 id="%E8%B0%83%E8%AF%95%E5%92%8C%E7%9B%91%E6%8E%A7">调试和监控 <a class="heading-anchor-permalink" href="#%E8%B0%83%E8%AF%95%E5%92%8C%E7%9B%91%E6%8E%A7">#</a></h3>
<ol>
<li><strong>使用LoggingListener</strong>：在开发阶段启用详细的日志记录</li>
<li><strong>MetricsListener</strong>：生产环境中收集性能指标</li>
<li><strong>ProgressListener</strong>：提供用户友好的进度反馈</li>
<li><strong>自定义监听器</strong>：根据业务需求实现特定的监控逻辑</li>
</ol>
<h3 id="%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5">测试策略 <a class="heading-anchor-permalink" href="#%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5">#</a></h3>
<ol>
<li><strong>单元测试</strong>：为自定义监听器编写单元测试</li>
<li><strong>集成测试</strong>：测试监听器与图执行的集成</li>
<li><strong>并发测试</strong>：验证监听器在高并发场景下的行为</li>
<li><strong>错误场景测试</strong>：测试监听器异常情况下的系统稳定性</li>
</ol>
<p>通过遵循这些最佳实践，可以充分发挥LangGraphGo监听器系统的强大功能，构建健壮、可观察的应用程序。</p>
</article>
</div>
<script>
      // Load contents.json if you need it
    </script>
<script>
      // FROM http://purecss.io/js/ui.js
      (function(window, document) {
        var layout = document.getElementById("layout"),
          menu = document.getElementById("menu"),
          menuLink = document.getElementById("menuLink");

        function toggleClass(element, className) {
          var classes = element.className.split(/\s+/),
            length = classes.length,
            i = 0;

          for (; i < length; i++) {
            if (classes[i] === className) {
              classes.splice(i, 1);
              break;
            }
          }
          // The className is not found
          if (length === classes.length) {
            classes.push(className);
          }

          element.className = classes.join(" ");
        }

        menuLink.onclick = function(e) {
          var active = "active";

          e.preventDefault();
          toggleClass(layout, active);
          toggleClass(menu, active);
          toggleClass(menuLink, active);
        };
      })(this, this.document);
    </script>
<script src="https://s4.zstatic.net/ajax/libs/mermaid/11.12.0/mermaid.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
<script>
    // 初始化 Mermaid - 在加载 app.js 之前
    console.log('初始化 Mermaid');
    mermaid.initialize({
        startOnLoad: false,
        theme: 'default',
        securityLevel: 'loose',
        pie: {
            textPosition: 0.75
        }
    });

    // 全局函数，用于处理 Mermaid 代码块
    window.processMermaidBlocks = async function () {
        console.log('开始处理 Mermaid 代码块...');

        const mermaidBlocks = document.querySelectorAll('code.language-mermaid');
        console.log('找到代码块数量:', mermaidBlocks.length);

        if (mermaidBlocks.length === 0) {
            console.log('没有找到 Mermaid 代码块');
            return;
        }

        for (let i = 0; i < mermaidBlocks.length; i++) {
            const block = mermaidBlocks[i];

            // 检查是否已经处理过
            if (block.dataset.mermaidProcessed) {
                continue;
            }

            const mermaidCode = block.textContent || block.innerText;
            console.log(`处理第 ${i + 1} 个代码块:`, mermaidCode);

            // 创建图表容器
            const diagramId = `mermaid-diagram-${Date.now()}-${i}`;
            const diagramContainer = document.createElement('div');
            diagramContainer.id = diagramId;
            diagramContainer.className = 'mermaid-diagram';
            diagramContainer.innerHTML = '<p>正在渲染图表...</p>';

            // 插入到代码块后面
            block.parentElement.insertAdjacentElement('afterend', diagramContainer);

            try {
                console.log('开始渲染图表...');

                // 生成唯一的 SVG ID
                const svgId = `diagram-svg-${Date.now()}-${i}`;

                const result = await mermaid.render(svgId, mermaidCode);
                console.log('渲染成功');

                diagramContainer.innerHTML = result.svg;

                // 隐藏原始代码块
                block.parentElement.style.display = 'none';

                // 标记为已处理
                block.dataset.mermaidProcessed = 'true';

            } catch (error) {
                console.error('渲染失败:', error);
                diagramContainer.innerHTML = `
                    <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 4px;">
                        <strong>图表渲染失败:</strong><br>
                        ${error.message}<br>
                        <details>
                            <summary>原始代码</summary>
                            <pre>${mermaidCode}</pre>
                        </details>
                    </div>
                `;
            }
        }
    }

    // 在脚本末尾添加
    window.addEventListener('load', function() {
        console.log('所有资源加载完成，开始处理 Mermaid');
        window.processMermaidBlocks();
    });
    hljs.highlightAll();
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add click event to all headings
        const headings = document.querySelectorAll('#menu .heading');
        
        headings.forEach(heading => {
            heading.addEventListener('click', function() {
                // Toggle the expanded class on the heading
                this.classList.toggle('expanded');
                
                // Find the next sibling which should be the ul
                let nextSibling = this.nextElementSibling;
                while (nextSibling) {
                    if (nextSibling.tagName === 'UL') {
                        nextSibling.classList.toggle('expanded');
                        break;
                    }
                    nextSibling = nextSibling.nextElementSibling;
                }
            });
        });

        // Expand the menu to show the active link
        const activeLink = document.querySelector('#menu a.active');
        if (activeLink) {
            let parent = activeLink.parentElement;
            while (parent && parent.id !== 'menu') {
                if (parent.tagName === 'UL') {
                    parent.classList.add('expanded');
                    // Find the previous sibling heading and expand it
                    let previousSibling = parent.previousElementSibling;
                    while (previousSibling) {
                        if (previousSibling.classList.contains('heading')) {
                            previousSibling.classList.add('expanded');
                            break;
                        }
                        previousSibling = previousSibling.previousElementSibling;
                    }
                }
                parent = parent.parentElement;
            }
        }
    });
</script>
</body>
</html>
